name: Docker

on:
    push:
          tags:
                  - 'v*.*.*'   # ex: v1.0.0

                    jobs:
                        build-and-push:
                              runs-on: ubuntu-latest
                                  permissions:
                                          contents: read
                                                packages: write   # n√©cessaire pour pousser sur GHCR

                                                    steps:
                                                            - name: Checkout
                                                                    uses: actions/checkout@v4

                                                                          - name: Log in to GHCR
                                                                                  uses: docker/login-action@v3
                                                                                          with:
                                                                                                      registry: ghcr.io
                                                                                                                username: ${{ github.actor }}
                                                                                                                          password: ${{ secrets.GITHUB_TOKEN }}

                                                                                                                                - name: Extract metadata (tags, labels)
                                                                                                                                        id: meta
                                                                                                                                                uses: docker/metadata-action@v5
                                                                                                                                                        with:
                                                                                                                                                                    images: ghcr.io/${{ github.repository }}
                                                                                                                                                                              tags: |
                                                                                                                                                                                            type=ref,event=tag

                                                                                                                                                                                                  - name: Set up Buildx
                                                                                                                                                                                                          uses: docker/setup-buildx-action@v3

                                                                                                                                                                                                                - name: Build and push
                                                                                                                                                                                                                        uses: docker/build-push-action@v6
                                                                                                                                                                                                                                with:
                                                                                                                                                                                                                                            context: .
                                                                                                                                                                                                                                                      push: true
                                                                                                                                                                                                                                                                tags: ${{ steps.meta.outputs.tags }}
                                                                                                                                                                                                                                                                          labels: ${{ steps.meta.outputs.labels }}

