name: Deploy

on:
    workflow_dispatch:
          inputs:
                  version:
                            description: "Tag/version à déployer (ex: v1.0.0)"
                                    required: true
                                            default: "v1.0.0"

                                            jobs:
                                                deploy:
                                                      runs-on: ubuntu-latest
                                                          environment:
                                                                  name: production     # ← délenche l’approbation avant exécution
                                                                      permissions:
                                                                              contents: read
                                                                                    packages: read

                                                                                        steps:
                                                                                                - name: Plan
                                                                                                        run: echo "Déploiement de l’image ghcr.io/${{ github.repository }}:${{ github.event.inputs.version }} sur production..."

                                                                                                              - name: Vérifier le secret est disponible
                                                                                                                      run: |
                                                                                                                                  if [ -z "${APP_SECRET}" ]; then
                                                                                                                                              echo "Secret APP_SECRET manquant !" && exit 1
                                                                                                                                                        fi
                                                                                                                                                                  echo "APP_SECRET récupéré (longueur: ${#APP_SECRET})"
                                                                                                                                                                          env:
                                                                                                                                                                                      APP_SECRET: ${{ secrets.APP_SECRET }}

